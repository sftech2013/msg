var __indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},__slice=[].slice;!function(a){var b,c;return a.Chooser=function(){function a(a){var b,c,d,e;for(this.model=a,this.model._chooser=this,e=this._publicMethods(),c=0,d=e.length;d>c;c++)b=e[c],this.model[b]=_.bind(this[b],this);this.chosen=!1,this.model.set({chosen:!1})}return a.prototype._publicMethods=function(){return["choose","unchoose","toggleChoose","isChosen"]},a.prototype.isChosen=function(){return!!this.chosen},a.prototype.choose=function(a){var b;return null==a&&(a={}),this.isChosen()?void 0:(this.chosen=!0,this.model.set({chosen:!0},a),a.silent!==!0&&this.model.trigger("model:chosen",this.model),null!=(b=this.model.collection)&&"function"==typeof b.choose?b.choose(this.model,a):void 0)},a.prototype.unchoose=function(a){var b;return null==a&&(a={}),this.isChosen()?(this.chosen=!1,this.model.set({chosen:!1},a),a.silent!==!0&&this.model.trigger("model:unchosen",this.model),null!=(b=this.model.collection)&&"function"==typeof b.unchoose?b.unchoose(this.model,a):void 0):void 0},a.prototype.toggleChoose=function(){return this.isChosen()?this.unchoose():this.choose()},a}(),b=function(){function a(a){var b,c,d,e;for(this.collection=a,this.collection._chooser=this,this.collection._chooser.chosen={},e=this._publicMethods(),c=0,d=e.length;d>c;c++)b=e[c],this.collection[b]=_.bind(this[b],this)}return a.prototype._publicMethods=function(){return["choose","unchoose","getChosen","getFirstChosen","chooseById"]},a.prototype.getChosen=function(){return _.toArray(this.chosen)},a.prototype.getFirstChosen=function(){return this.getChosen()[0]},a.prototype.modelInChosen=function(a){var b;return b=a.cid,__indexOf.call(_.keys(this.chosen),b)>=0},a.prototype.addModel=function(a,b){return null==b&&(b={}),this.chosen[a.cid]=a,"function"==typeof a.choose?a.choose(b):void 0},a.prototype.removeModels=function(a){var b,c,d,e;for(null==a&&(a=!1),d=_.flatten([a||this.getChosen()]),e=[],b=0,c=d.length;c>b;b++)a=d[b],delete this.chosen[a.cid],e.push("function"==typeof a.unchoose?a.unchoose():void 0);return e},a.prototype.triggerEvent=function(a,b){return null==a&&(a=!1),null==b&&(b={}),_.defaults(b,{silent:!1}),b.silent!==!0?(a||(a=this._getEvent()),this.collection.trigger(a,this._eventArg())):void 0},a.prototype.chooseById=function(a,b){var c;return null==b&&(b={}),c=this.collection.get(a),c?this.choose(c,b):void 0},a}(),a.SingleChooser=function(a){function b(){return c=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype._eventArg=function(){return this.getFirstChosen()},b.prototype.choose=function(a,b){return this.modelInChosen(a)?void 0:(this.removeModels(),this.addModel(a),this.triggerEvent("collection:chose:one",b))},b.prototype.unchoose=function(a,b){return this.modelInChosen(a)?(this.removeModels(a),this.triggerEvent("collection:unchose:one",b)):void 0},b}(b),a.MultiChooser=function(b){function c(){var a,b,d,e;for(c.__super__.constructor.apply(this,arguments),e=["chooseAll","chooseNone","chooseByIds"],b=0,d=e.length;d>b;b++)a=e[b],this.collection[a]=_.bind(this[a],this)}return __extends(c,b),c.prototype._eventArg=function(){return this.getChosen()},c.prototype.choose=function(){var b,c,d,e,f,g,h;for(b=1<=arguments.length?__slice.call(arguments,0):[],e=_.chain(b).flatten().last().value()instanceof a.Model?{}:b.pop(),c=!1,h=_([b]).flatten(),f=0,g=h.length;g>f&&(d=h[f],!this.modelInChosen(d));f++)c||(c=!0),this.addModel(d,e);return c?this.triggerEvent(!1,e):void 0},c.prototype.unchoose=function(){var b,c,d,e,f,g,h;for(b=1<=arguments.length?__slice.call(arguments,0):[],e=_.chain(b).flatten().last().value()instanceof a.Model?{}:b.pop(),c=!1,h=_([b]).flatten(),f=0,g=h.length;g>f&&(d=h[f],this.modelInChosen(d));f++)c||(c=!0),this.removeModels(d,e);return c?this.triggerEvent(!1,e):void 0},c.prototype.chooseAll=function(a){var b,c,d,e;if(null==a&&(a={}),_.difference(this.collection.models,this.getChosen()).length){for(e=this.collection.models,c=0,d=e.length;d>c;c++)b=e[c],this.addModel(b);return this.triggerEvent(!1,a)}},c.prototype.chooseNone=function(a){return null==a&&(a={}),0!==this.getChosen().length?(this.removeModels(),this.triggerEvent(!1,a)):void 0},c.prototype.chooseByIds=function(a,b){var c,d,e,f,g;for(null==a&&(a=[]),null==b&&(b={}),_.defaults(b,{chooseNone:!0}),b.chooseNone&&this.chooseNone(b),f=_([a]).flatten(),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(this.chooseById(c,b));return g},c.prototype._getEvent=function(){return this.collection.length===this.getChosen().length?"collection:chose:all":0===this.getChosen().length?"collection:chose:none":"collection:chose:some"},c}(b)}(Backbone);